<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Post Call Summaries : AR Portal</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../style/main-style.css" />
    <link rel="stylesheet" href="../style/bot-style.css">
    <link rel="stylesheet" href="../style/reports-style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://unpkg.com/@phosphor-icons/web">

    </script>
  </head>
  <body>
    <div class="d-flex">
      <nav class="sidebar vh-100 p-4 d-flex flex-column justify-content-center" style="width: 300px;">
        <div>
          <img src="../asset/logo.png" />
          <h5
            class="headd text-primary fw-bold"
            style="margin-left: 40px; margin-top: 10px"
          >
            AR Webportal
          </h5>
          <div class="sidebar-header d-flex align-items-center mb-1"></div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">
                <i class="ph-bold ph-layout"></i>
                <span>Collection Analytics</span>
              </a>
            </li>
            <!-- <li class="nav-item">
              <a class="nav-link" href="./caller.html">
                <i class="ph ph-bell"></i>
                <span>Caller</span>
              </a>
            </li> -->
            <li class="nav-item">
              <a class="nav-link active" href="#" onclick="toggleDropdown(event)">
                <i class="ph ph-film-script"></i>
                <span>Calls</span>
                <!-- <i class="ph ph-caret-down arrow-icon"></i> -->
              </a>
              <ul class="sidebar-dropdown">
                <li>
                  <a class="nav-link dropdown-item" href="./pre-call.html">
                    <i class="ph ph-robot"></i>
                    <span>Precall Agent</span>
                  </a>
                </li>
                <li>
                  <a class="nav-link dropdown-item active" href="#">
                    <i class="ph ph-robot"></i>
                    <span>Postcall Agent</span>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./caller.html">
                <i class="ph ph-phone-call"></i>
                <span>Caller Agent</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./reports.html">
                <i class="ph ph-chat-circle-dots"></i>
                <span>Reports</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="ph ph-chart-bar"></i>
                <span>Predective Analytics</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="ph ph-gear"></i>
                <span>Settings</span>
              </a>
            </li>
          </ul>
          <div class="chats-history mt-1">
            <h6 class="text-muted fw-bold ps-3 mb-3">Call History</h6>
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="./History/call-history.html">
                  <i class="ph ph-chat-circle-dots"></i>
                  <span>Call History of Today</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./History/client-history.html">
                  <i class="ph ph-archive"></i>
                  <span>Client History</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div
          class="user-profile d-flex align-items-center p-2 rounded-3"
          style="margin-top: 10px"
        >
          <i class="ph-bold ph-user p-1"></i>
          <div class="flex-grow-1">
            <h6 class="mb-0 fw-bold">John Doe</h6>
          </div>
          <i class="ph ph-sign-out"></i>
        </div>
      </nav>

      <main class="main-content flex-grow-1 p-4">
        <header
          class="d-flex justify-content-between align-items-center mb-3 p-1"
          style="background-color: white; border-radius: 15px"
        >
          <h2
            class="fw-bold"
            style="font-size: 1.4rem; padding-left: 1.01rem; padding-top: 5px"
          >
            Post Call Agent Reports
          </h2>
          <div class="d-flex align-items-center">
            <span class="text-muted me-3"
              >Last Update: 17 September 2025, 03:51 PM</span
            >
            <button class="btn btn-icon me-2">
              <i class="ph ph-question"></i>
            </button>
            <button class="btn btn-icon"><i class="ph ph-bell"></i></button>
          </div>
        </header>

        <div class="date-range-picker mb-4">
          <i class="ph ph-calendar-blank"></i>
          <span> 18 Sept 2025</span>
        </div>

        <div class="filter-bar card mb-4">
          <select id="statusFilter" class="form-select">
            <option value="all">View All</option>
            <option value="success">Success</option>
            <!-- <option value="notpicked">Pending</option>
            <option value="notpicked">Dispute</option> -->
          </select>
          <select id="sortFilter" class="form-select">
            <option value="date">Sort by Date</option>
            <option value="amount">Sort by Amount</option>
          </select>
          <button class="btn btn-primary" onclick="handleUpload(this)">
            Download Summary
          </button>
        </div>

        <div class="reports-container">
          <div id="cardsContainer" class="row g-4"></div>
        </div>
      </main>
    </div>

    <div
      class="modal fade"
      id="reportIssueModal"
      tabindex="-1"
      aria-labelledby="reportIssueModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reportIssueModalLabel">
              Report an issue
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="areaSelect" class="form-label"
                >What area are you having problems with?</label
              >
              <select id="areaSelect" class="form-select mb-3">
                <option selected>Billing</option>
                <option>Technical</option>
                <option>User Interface</option>
                <option>Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="severitySelect" class="form-label"
                >Security Level</label
              >
              <select id="severitySelect" class="form-select">
                <option selected>Severity 2</option>
                <option>Severity 1</option>
                <option>Severity 3</option>
                <option>Severity 4</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="subjectInput" class="form-label">Subject</label>
              <input
                type="text"
                id="subjectInput"
                class="form-control"
                placeholder="I need help with..."
              />
            </div>
            <div class="mb-3">
              <label for="descriptionTextarea" class="form-label"
                >Description</label
              >
              <textarea
                id="descriptionTextarea"
                class="form-control"
                rows="5"
                placeholder="Please include all information relevant to your issue."
              ></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="handleReportSubmission()"
            >
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div
      class="modal fade"
      id="transcriptModal"
      tabin`x="-1"
      aria-labelledby="transcriptModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="transcriptModalLabel">
              Transcript for...
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <textarea
              class="form-control"
              rows="10"
              placeholder="Transcript goes here..."
            ></textarea>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="alert('Transcript Saved')"
            >
              Save Transcript
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="detailsModal"
      tabindex="-1"
      aria-labelledby="detailsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailsModalLabel">Details for...</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Important Key Points</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td contenteditable="true"></td>
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="alert('Additional Report saved for user')"
            >
              Save Report
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- <button class="chat-float-btn" id="chatOpenBtn" aria-label="Open chat">
          <img
            src="../asset/Capgemini-Symbol.png"
            alt="Bot"
            style="
              width: 50px;
              height: 52px;
              border-radius: 50%;
              object-fit: cover;
            "
          />
        </button> -->

        <div class="floating-chat-window" id="floatingChatWindow">
          <div class="chat-header">
            <img src="../asset/Capgemini-Symbol.png" alt="Bot" />
            <span class="chat-bot-name">John - AR Bot</span>
            <button class="chat-close-btn" id="chatCloseBtn" title="Close chat">
              &times;
            </button>
          </div>
          <div class="chat-body" id="chatBody">
            <div style="color: #888; font-size: 0.95em">
              Hi! I’m James, your AR assistant. I can help you with 'invoice', 'account' and 'raise dispute'.
            </div>
          </div>
          <form class="chat-input-area" id="chatInputForm" autocomplete="off">
            <input
              type="text"
              id="chatInput"
              placeholder="Type your message..."
              autocomplete="off"
            />
            <button type="submit">Close</button>
          </form>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="../scripts/drop-down-animation.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const allUsers = [
          {
            name: "David",
            phone: "040-123-123",
            reason: "credit",
            amount: 1250.00,
            last_call_date: "2025-08-25",
            status: "Pending",
            Note: "The customer stated that they, would try to pay the remaining loan payment in another 3 days",
            RCA: "Issues with the banking server, account frozen",
            Followup : "True",
            Total_Invoices : 2
          },
          {
            name: "Sophia Anderson",
            phone: "040-333-111",
            reason: "loan",
            amount: 300.0,
            last_call_date: "2025-08-01",
            status: "Success",
            Note: "The customer stated that they has raised a dispute and it was solved",
            RCA: "Customer was charged extra $20.89 but no transcation was found",
            Followup : "False",
            Total_Invoices : 1
          },
          {
            name: "ANNA",
            phone: "040-555-789",
            reason: "loan",
            amount: 320.45,
            last_call_date: "2025-08-02",
            status: "Dispute",
            Note: "The customer stated dispute, reagarding payment but did not clear on the promised date",
            RCA: "Dispute was raised for $200.89, Charged twice for a item",
            Followup : "True",
            Total_Invoices : 1
          },
          // {
          //   name: "MARK",
          //   phone: "040-444-222",
          //   reason: "bill",
          //   amount: 550.5,
          //   date: "2025-08-02",
          //   status: "Not Picked",
          // },
          // {
          //   name: "JOHN",
          //   phone: "040-222-999",
          //   reason: "bill",
          //   amount: 123.0,
          //   date: "2025-08-03",
          //   status: "Success",
          // },
        ];

        // Data for user summaries
        const userSummaries = {
          David: "MAX's summary: The customer was successfully reached, and a payment plan was agreed upon. He will pay the outstanding credit amount within the next 3 months.",
          LISA: "LISA's summary: The call to Lisa was not picked up. A follow-up call is scheduled for tomorrow morning to discuss her outstanding loan balance.",
          ANNA: "ANNA's summary: Anna was successfully contacted, and she has agreed to clear her loan account by the end of the week. No further action is required.",
          MARK: "MARK's summary: Mark could not be reached. The phone went to voicemail. An automated reminder has been sent regarding his outstanding bill.",
          JOHN: "JOHN's summary: The call with John was a success. He made a full payment for his bill. The account is now cleared.",
        };

        const container = document.getElementById("cardsContainer");
        const statusFilter = document.getElementById("statusFilter");
        const sortFilter = document.getElementById("sortFilter");

        function renderCards(data) {
          container.innerHTML = "";
          data.forEach((user) => {
            const card = document.createElement("div");
            card.className = "col-lg-4 col-md-6";
            const statusClass =
              user.status === "Success" ? "status-success" : "status-fail";
              // user.status === "Pending" ? "status-pending" : "status-fail";
            card.innerHTML = `
                <div class="card report-card" style="background-color: smokewhite;">
                  <h5 class="card-title">${user.name}</h5>
                  <p><strong>Reason:</strong> ${user.reason}</p>
                  <p><strong>Due Amount:</strong> $${user.amount.toFixed(2)}</p>
                  <p class="status-text ${statusClass}"><strong>Call Status:</strong> ${
              user.status
            }</p>
                  <div class="card-actions">
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#transcriptModal" data-user-name="${
                      user.name
                    }">Recent Call Summary</button>
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#reportIssueModal" data-user-name="${
                      user.name
                    }">Call Summaries</button>
                  </div>
                </div>`;
            container.appendChild(card);
          });
        }

        function sortData(data, sortBy) {
          return data.sort((a, b) =>
            sortBy === "date"
              ? new Date(a.date) - new Date(b.date)
              : a.amount - b.amount
          );
        }

        function updateView() {
          const status = statusFilter.value;
          const sortBy = sortFilter.value;
          let dataToRender =
            status === "all"
              ? [...allUsers]
              : status === "success"
              ? allUsers.filter((u) => u.status === "Success")
              : allUsers.filter((u) => u.status === "Not Picked");
          let sortedData = sortData(dataToRender, sortBy);
          renderCards(sortedData);
        }

        statusFilter.addEventListener("change", updateView);
        sortFilter.addEventListener("change", updateView);

        // Event listener for the transcript modal
        document
          .getElementById("transcriptModal")
          .addEventListener("show.bs.modal", function (event) {
            const userName = event.relatedTarget.getAttribute("data-user-name");
            const transcriptTextarea = this.querySelector(".modal-body textarea");

            // Set the modal title
            this.querySelector(".modal-title").textContent =
              "Transcript for " + userName;

            // Set the summary in the textarea
            transcriptTextarea.value = userSummaries[userName] || "No summary available.";
          });

        // Event listener for the report issue modal
        document
          .getElementById("reportIssueModal")
          .addEventListener("show.bs.modal", function (event) {
            const userName = event.relatedTarget.getAttribute("data-user-name");
            this.querySelector(".modal-title").textContent =
              "Report an issue for " + userName;
          });

        updateView();

        // CSV Download Function
        window.handleUpload = function (button) {
          const csvRows = [];
          const headers = Object.keys(allUsers[0]);
          csvRows.push(headers.join(","));

          allUsers.forEach((user) => {
            const values = headers.map((header) => `"${user[header]}"`);
            csvRows.push(values.join(","));
          });

          const csvData = csvRows.join("\n");
          const blob = new Blob([csvData], { type: "text/csv" });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.setAttribute("hidden", "");
          a.setAttribute("href", url);
          a.setAttribute("download", "webcollect_data.csv");
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);

          button.classList.remove("btn-primary");
          button.classList.add("btn-success");
        };
      });

      // Function to handle the report issue form submission
      function handleReportSubmission() {
        alert("Issue submitted successfully!");
        const reportIssueModal = bootstrap.Modal.getInstance(
          document.getElementById("reportIssueModal")
        );
        reportIssueModal.hide();
      }
    </script>
    <script src="../scripts/bot-script.js"></script>
    <script src="../scripts/post-call-script.js"></script>
  </body>
</html>